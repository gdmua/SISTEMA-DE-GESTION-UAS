<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sistema de Gesti√≥n de UAS</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

  <!-- Fuente -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    *{margin:0;padding:0;box-sizing:border-box}

    :root{
      --primary:#2563eb;
      --primary-600:#1d4ed8;
      --secondary:#7c3aed;
      --success:#10b981;
      --warning:#f59e0b;
      --danger:#ef4444;

      --bg:#0b1220;        /* fondo app */
      --panel:#ffffff;     /* panel cards */
      --ink:#0f172a;       /* texto principal */
      --muted:#64748b;     /* texto secundario */
      --muted-2:#94a3b8;   /* texto tenue */
      --line:#e2e8f0;      /* bordes suaves */

      --chip:#0f1b33;      /* chips header */
      --chip-border:#27436f;

      --radius:16px;
      --shadow-1:0 10px 30px rgba(2,8,23,.25);
      --shadow-2:0 12px 24px rgba(2,8,23,.08);
    }

    html,body{height:100%}
    body{
      font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: radial-gradient(1200px 800px at 8% -10%, #11213a 0%, #0b1220 40%, #0a0f1a 100%);
      color:var(--ink);
      overflow:hidden;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .container{
      display:flex; flex-direction:column; height:100vh;
      background:
        linear-gradient(180deg, rgba(255,255,255,.06) 0%, rgba(255,255,255,0) 60%),
        linear-gradient(180deg, #0e1524 0%, #0a0f1a 100%);
    }

    /* Header */
    .dashboard-header{
      background:linear-gradient(135deg, #0b1220, #0f1a33 60%, #14223d);
      color:#eaf1ff; padding:1rem 1.5rem; display:flex; justify-content:space-between; align-items:center;
      border-bottom:1px solid rgba(255,255,255,.06);
      box-shadow:var(--shadow-1); flex-shrink:0; position:relative; z-index:2;
      flex-wrap:wrap; gap:1rem;
    }
    .header-left h1{
      font-size:1.45rem; font-weight:800; letter-spacing:.2px; line-height:1.1;
      background:linear-gradient(135deg, #b6ccff, #60a5fa, #3b82f6);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
      text-shadow:0 0 22px rgba(59,130,246,.25);
      margin-bottom:.2rem;
    }
    .header-left p{font-size:.9rem; color:#cfe0ff}

    .status-chips{display:flex; gap:.75rem; flex-wrap:wrap}
    .chip{
      display:flex; align-items:center; gap:.55rem; padding:.5rem 1rem; border-radius:999px;
      background:var(--chip); border:1px solid var(--chip-border);
      box-shadow:inset 0 0 0 1px rgba(255,255,255,.04);
      color:#e5edff; font-weight:700;
      font-size:.85rem;
    }
    .chip .dot{width:8px;height:8px;border-radius:50%;background:var(--success);box-shadow:0 0 10px rgba(16,185,129,.8);}

    /* Main */
    .main-content{
      display:flex; flex:1; gap:1.1rem; padding:1.1rem; overflow:hidden; min-height:0;
      flex-direction:column;
    }

    .panel{
      background:var(--panel); border-radius:var(--radius); position:relative; overflow:hidden;
      border:1px solid var(--line); box-shadow:var(--shadow-2);
    }
    .control-panel{width:100%; display:flex; flex-direction:column; order:1;}
    .map-panel{flex:1; display:flex; flex-direction:column; min-width:0; order:2;}
    .drones-panel{width:100%; display:flex; flex-direction:column; order:3;}

    .content-wrapper{display:flex; flex-direction:column; height:100%; gap:1rem; padding:1.1rem;}

    .panel-title{
      display:flex; align-items:center; gap:.6rem; color:var(--ink); font-weight:800; font-size:.98rem;
      border-bottom:2px solid var(--line); padding-bottom:.6rem;
    }
    .panel-title::before{
      content:""; width:6px; height:18px; border-radius:4px;
      background:linear-gradient(180deg, var(--primary), var(--secondary));
      box-shadow:0 0 16px rgba(37,99,235,.35);
    }

    /* Stats */
    .stats-grid{display:grid; grid-template-columns:1fr 1fr; gap:.8rem;}
    .stat-card{
      position:relative; overflow:hidden; border-radius:14px; color:#fff;
      background: linear-gradient(135deg, rgba(37,99,235,1) 0%, rgba(99,102,241,1) 100%);
      padding:1.05rem;
    }
    .stat-value{font-size:1.7rem; font-weight:800; line-height:1;}
    .stat-label{font-size:.82rem; font-weight:600; opacity:.95;}

    /* Status cards */
    .system-status{display:flex; flex-direction:column; gap:.75rem;}
    .status-card{background:linear-gradient(180deg,#f8fbff,#ffffff); padding:1rem; border-radius:12px; border:1px solid var(--line);}
    .status-row{display:flex; align-items:center; gap:.55rem; font-weight:800; color:var(--ink)}
    .metric-item{display:flex; justify-content:space-between; align-items:center; padding:.55rem 0; border-bottom:1px dashed var(--line);}
    .metric-item:last-child{border-bottom:0}
    .metric-label{font-size:.82rem; color:var(--muted)}
    .metric-value{font-weight:800; font-size:.9rem; color:var(--ink)}

    /* Map header */
    .map-header{
      padding:.9rem 1.05rem; display:flex; justify-content:space-between; align-items:center;
      border-bottom:1px solid var(--line); background:#fff;
      flex-wrap:wrap; gap:.75rem;
    }
    .map-header h3{font-weight:800; font-size:1.02rem; color:var(--ink); line-height:1.3;}
    .legend{display:flex; gap:.5rem; flex-wrap:wrap}
    .legend-item{
      display:flex; align-items:center; gap:.45rem;
      background:#f7fbff; color:var(--ink); border:1px solid var(--line);
      padding:.4rem .65rem; border-radius:999px; font-weight:700; font-size:.8rem;
    }
    .legend-dot{width:12px;height:12px;border-radius:50%}
    .legend-dot.commercial{background:var(--danger)}
    .legend-dot.delivery{background:var(--primary)}
    .legend-dot.surveillance{background:var(--secondary)}

    /* Map controls (botonera) */
    .map-controls{display:flex; align-items:center; gap:.5rem; flex-wrap:wrap}
    .btn{
      border:1px solid var(--line); border-radius:10px; padding:.55rem .8rem; font-weight:700; font-size:.85rem;
      background:#fff; color:var(--ink); cursor:pointer;
      transition:transform .08s ease, box-shadow .2s ease, background .15s ease, border .15s ease;
    }
    .btn:hover{background:#f8fafc; box-shadow:0 6px 14px rgba(2,8,23,.08)}
    .btn:active{transform:translateY(1px)}
    .btn-primary{
      background:linear-gradient(180deg,#2563eb,#1d4ed8); color:#fff; border-color:#1e3a8a;
      box-shadow:0 8px 16px rgba(37,99,235,.22);
    }
    .btn-primary:hover{filter:brightness(1.05)}
    .btn-ghost{background:#fff}
    .btn-icon{display:inline-flex; align-items:center; gap:.5rem}

    .map-container{flex:1; position:relative; min-height:400px;}
    #map{width:100%; height:100%}

    /* Drones list */
    .search-box{position:relative}
    .search-box input{
      width:100%; padding:.8rem 1rem .8rem 2.4rem; border:1px solid var(--line);
      border-radius:12px; background:#f8fafc; font-size:.9rem; transition:border .2s, box-shadow .2s, background .2s;
    }
    .search-box input:focus{outline:none; border-color:var(--primary); box-shadow:0 0 0 4px rgba(37,99,235,.12); background:#fff}
    .search-box::before{content:'üîç'; position:absolute; left:.8rem; top:50%; transform:translateY(-50%); opacity:.7}
    .drones-list{display:flex; flex-direction:column; gap:.75rem}
    .drone-item{background:#fff; padding:1rem 1.05rem; border-radius:12px; border:1px solid var(--line); transition:transform .15s ease, box-shadow .2s ease;}
    .drone-item:hover{transform:translateX(4px); box-shadow:0 10px 20px rgba(15,23,42,.08)}
    .drone-item-header{display:flex; justify-content:space-between; align-items:center; margin-bottom:.35rem}
    .drone-id{font-weight:800; color:var(--ink)}
    .drone-type{font-size:.72rem; padding:.28rem .65rem; border-radius:999px; font-weight:800; color:#fff; background:var(--primary)}
    .drone-info{font-size:.85rem; color:var(--muted); line-height:1.55}
    .drone-info strong{color:var(--ink)}

    /* Alerts */
    .alerts-container{display:flex; flex-direction:column; gap:.7rem}
    .alert-item{padding:1rem; border-radius:12px; font-size:.86rem; border:1px solid var(--line); background:#f8fafc}
    .alert-item.info{background:#eff6ff; border-color:#bfdbfe}
    .alert-item.warning{background:#fffbeb; border-color:#fde68a}
    .alert-item.danger{background:#fef2f2; border-color:#fecaca}
    .alert-item.success{background:#f0fdf4; border-color:#bbf7d0}
    .alert-item small{display:block; opacity:.7; margin-top:.25rem; font-weight:700}

    /* Footer */
    .dashboard-footer{
      background:linear-gradient(135deg, #0b1220, #0d162b);
      color:#c7d2fe; padding:1rem 1.5rem; display:flex; justify-content:space-between; font-size:.86rem;
      border-top:1px solid rgba(255,255,255,.06);
      flex-wrap:wrap; gap:.5rem;
    }

    /* Scrollbars */
    .panel-section.scrollable{overflow-y:auto; max-height:300px;}
    .drones-panel .content-wrapper{overflow-y:auto;}
    .control-panel .content-wrapper{overflow-y:auto;}
    
    ::-webkit-scrollbar{width:8px;height:8px}
    ::-webkit-scrollbar-track{background:rgba(148,163,184,.15);border-radius:6px}
    ::-webkit-scrollbar-thumb{background:linear-gradient(180deg, #94a3b8, #64748b);border-radius:6px}
    ::-webkit-scrollbar-thumb:hover{background:#475569}

    /* Pol√≠gonos mejorados - L√çNEA CONTINUA */
    .polygon-commercial {
      stroke: #ef4444;
      stroke-width: 2;
      fill: rgba(239, 68, 68, 0.15);
      stroke-dasharray: none;
    }

    .polygon-delivery {
      stroke: #2563eb;
      stroke-width: 2;
      fill: rgba(37, 99, 235, 0.15);
      stroke-dasharray: none;
    }

    .polygon-surveillance {
      stroke: #7c3aed;
      stroke-width: 2;
      fill: rgba(124, 58, 237, 0.15);
      stroke-dasharray: none;
    }

    /* Bater√≠a */
    .battery-indicator{display:inline-block; width:64px; height:12px; background:var(--line); border-radius:6px; overflow:hidden; vertical-align:middle; margin-left:.35rem}
    .battery-level{height:100%; border-radius:6px; transition:width .25s ease}
    .battery-high{background:var(--success)}
    .battery-medium{background:var(--warning)}
    .battery-low{background:var(--danger)}

    /* EXPANDIR MAPA (layout alterno) */
    .map-expanded .control-panel,
    .map-expanded .drones-panel{display:none}
    .map-expanded .map-panel{flex:1 1 100%}
    .map-expanded .main-content{padding:0; gap:0}
    .map-expanded .map-header{border-radius:0; border-left:0; border-right:0}
    .map-expanded .map-panel{border-radius:0; border-left:0; border-right:0}
    .map-expanded #map{border-radius:0}

    /* Mobile Menu */
    .mobile-menu-btn{
      display:none; background:none; border:none; color:#eaf1ff; font-size:1.5rem; cursor:pointer;
      padding:.5rem; border-radius:8px; transition:background .2s;
    }
    .mobile-menu-btn:hover{background:rgba(255,255,255,.1)}

    /* Panel Toggles */
    .panel-toggle{
      display:none; position:absolute; top:1rem; right:1rem; z-index:10;
      background:var(--primary); color:white; border:none; border-radius:50%;
      width:40px; height:40px; cursor:pointer; box-shadow:var(--shadow-1);
    }

    /* ===== RESPONSIVE DESIGN ===== */
    
    /* Tablets (768px - 1024px) */
    @media (min-width:768px){
      .main-content{
        flex-direction:row; flex-wrap:wrap;
      }
      .control-panel{width:48%; order:1;}
      .map-panel{width:100%; order:3; min-height:500px;}
      .drones-panel{width:48%; order:2;}
    }

    /* Desktop peque√±o (1024px - 1200px) */
    @media (min-width:1024px){
      .main-content{
        flex-direction:row; flex-wrap:nowrap;
      }
      .control-panel{width:320px; order:1;}
      .map-panel{flex:1; order:2; min-width:400px;}
      .drones-panel{width:350px; order:3;}
    }

    /* Desktop grande (>1200px) */
    @media (min-width:1200px){
      .control-panel{width:330px;}
      .drones-panel{width:390px;}
    }

    /* M√≥viles (<768px) */
    @media (max-width:767px){
      .dashboard-header{padding:1rem; flex-direction:column; align-items:flex-start;}
      .header-left{margin-bottom:.5rem;}
      .status-chips{justify-content:flex-start;}
      
      .main-content{padding:.5rem; gap:.5rem;}
      
      .map-header{padding:.75rem; flex-direction:column; align-items:flex-start; gap:.5rem;}
      .map-header h3{font-size:.95rem;}
      .map-controls{justify-content:flex-start;}
      
      .stats-grid{grid-template-columns:1fr; gap:.5rem;}
      .stat-card{padding:.8rem;}
      .stat-value{font-size:1.4rem;}
      
      .dashboard-footer{flex-direction:column; text-align:center; padding:.75rem 1rem;}
      
      /* Mobile menu */
      .mobile-menu-btn{display:block;}
      
      /* Panel toggles para m√≥viles */
      .control-panel, .drones-panel{
        position:fixed; top:0; left:0; width:100%; height:100%; 
        z-index:1000; transform:translateX(-100%); transition:transform .3s ease;
        border-radius:0;
      }
      .control-panel.active, .drones-panel.active{transform:translateX(0);}
      
      .panel-toggle{display:block;}
    }

    /* Pantallas muy peque√±as (<480px) */
    @media (max-width:480px){
      .dashboard-header h1{font-size:1.2rem;}
      .chip{font-size:.8rem; padding:.4rem .8rem;}
      
      .map-header h3{font-size:.85rem;}
      .legend-item{font-size:.7rem; padding:.3rem .5rem;}
      .btn{padding:.4rem .6rem; font-size:.8rem;}
      
      .content-wrapper{padding:.8rem;}
      .panel-title{font-size:.9rem;}
      
      .drone-item{padding:.8rem;}
      .drone-info{font-size:.8rem;}
    }

    /* Pantallas muy grandes (>1600px) */
    @media (min-width:1600px){
      .control-panel{width:360px;}
      .drones-panel{width:420px;}
      .main-content{gap:1.5rem; padding:1.5rem;}
    }

    /* Alturas espec√≠ficas */
    @media (max-height:700px){
      .panel-section.scrollable{max-height:200px;}
      .map-container{min-height:300px;}
    }

    @media (prefers-reduced-motion:reduce){*{animation:none !important; transition:none !important}}
  </style>
</head>
<body>
  <div class="container" id="app">
    <!-- Header -->
    <header class="dashboard-header">
      <div class="header-left">
        <h1>üöÅ Gobernaci√≥n del Valle del Cauca</h1>
        <p>Sistema de Gesti√≥n de UAS</p>
      </div>
      <div class="header-right">
        <button class="mobile-menu-btn" id="mobileMenuBtn">‚ò∞</button>
        <div class="status-chips">
          <div class="chip"><span class="dot"></span><span>Sistema: <strong>AUT√ìNOMO</strong></span></div>
          <div class="chip"><span class="dot"></span><span>Red: <strong>ESTABLE</strong></span></div>
        </div>
      </div>
    </header>

    <!-- Main -->
    <div class="main-content">
      <!-- Left -->
      <section class="control-panel panel" id="controlPanel">
        <button class="panel-toggle" id="toggleControlPanel">‚úï</button>
        <div class="content-wrapper">
          <div class="panel-section">
            <h3 class="panel-title">üìä ESTAD√çSTICAS EN TIEMPO REAL</h3>
            <div class="stats-grid">
              <div class="stat-card"><div class="stat-value" id="totalDrones">0</div><div class="stat-label">Pol√≠gonos Activos</div></div>
              <div class="stat-card"><div class="stat-value" id="activeFlights">0</div><div class="stat-label">Zonas Monitoreadas</div></div>
              <div class="stat-card"><div class="stat-value" id="conflicts">0</div><div class="stat-label">Alertas</div></div>
              <div class="stat-card"><div class="stat-value" id="avgSpeed">0</div><div class="stat-label">Operaciones/d√≠a</div></div>
            </div>
          </div>

          <div class="panel-section scrollable">
            <h3 class="panel-title">üì° ESTADO DEL SISTEMA</h3>
            <div class="system-status">
              <div class="status-card">
                <div class="status-row"><span class="dot" style="width:8px;height:8px;border-radius:50%;background:var(--success)"></span><span>Sistema: <strong>ACTIVO</strong></span></div>
                <div class="metric-item"><span class="metric-label">Tiempo ejecuci√≥n:</span><span class="metric-value" id="uptime">00:00:00</span></div>
              </div>
              <div class="status-card">
                <div class="status-row"><span class="dot" style="width:8px;height:8px;border-radius:50%;background:var(--success)"></span><span>Pol√≠gonos rurales: <strong id="noLocationDrones">0</strong></span></div>
                <div class="metric-item"><span class="metric-label">En Cali:</span><span class="metric-value" id="ruralDrones">0</span></div>
              </div>
              <div class="status-card">
                <div class="status-row"><span class="dot" style="width:8px;height:8px;border-radius:50%;background:var(--success)"></span><span>Pol√≠gonos urbanos: <strong id="activePolygons">0</strong></span></div>
                <div class="metric-item"><span class="metric-label">En Palmira:</span><span class="metric-value" id="updatedPolygons">0</span></div>
              </div>
              <div class="status-card">
                <div class="status-row"><span class="dot" style="width:8px;height:8px;border-radius:50%;background:var(--success)"></span><span>Total zonas: <strong id="urbanDrones">0</strong></span></div>
                <div class="metric-item"><span class="metric-label">Actualizado:</span><span class="metric-value" id="caliDrones">0</span></div>
              </div>
            </div>
          </div>

          <div class="panel-section scrollable">
            <h3 class="panel-title">‚ö†Ô∏è ALERTAS DEL SISTEMA</h3>
            <div id="alertsContainer" class="alerts-container">
              <div class="alert-item info"><span>Sistema UTM Cali inicializado</span><small>Modo aut√≥nomo activado</small></div>
            </div>
          </div>
        </div>
      </section>

      <!-- Center -->
      <section class="map-panel panel" id="mapPanel">
        <div class="map-header">
          <h3>üó∫Ô∏è MAPA DE OPERACIONES - CALI Y VALLE DEL CAUCA</h3>
          <div class="map-controls">
            <button class="btn btn-icon btn-primary" id="btnExpand">‚§¢ Expandir mapa</button>
            <button class="btn btn-icon btn-ghost" id="btnFullscreen">‚õ∂ Pantalla completa</button>
            <div class="legend" style="margin-left:.35rem">
              <div class="legend-item"><span class="legend-dot commercial"></span> Comercial</div>
              <div class="legend-item"><span class="legend-dot delivery"></span> Delivery</div>
              <div class="legend-item"><span class="legend-dot surveillance"></span> Vigilancia</div>
            </div>
          </div>
        </div>
        <div class="map-container">
          <div id="map"></div>
        </div>
      </section>

      <!-- Right -->
      <section class="drones-panel panel" id="dronesPanel">
        <button class="panel-toggle" id="toggleDronesPanel">‚úï</button>
        <div class="content-wrapper">
          <div class="panel-section">
            <h3 class="panel-title">‚úàÔ∏è ZONAS DE OPERACI√ìN</h3>
            <div class="search-box"><input type="text" id="droneSearch" placeholder="Buscar zona..."></div>
          </div>
          <div class="panel-section scrollable"><div id="dronesList" class="drones-list"></div></div>
        </div>
      </section>
    </div>

    <!-- Footer -->
    <footer class="dashboard-footer">
      <div>UTM Cali v4.2 ‚Ä¢ Sistema Aut√≥nomo de Gesti√≥n de Tr√°fico de Drones</div>
      <div id="timestamp">--:--:--</div>
    </footer>
  </div>

  <script>
    // üîí DESHABILITAR CLIC DERECHO Y OTRAS ACCIONES
    document.addEventListener('contextmenu', function(e) {
      e.preventDefault();
      return false;
    });

    // Deshabilitar arrastrar im√°genes
    document.addEventListener('dragstart', function(e) {
      e.preventDefault();
      return false;
    });

    // Deshabilitar selecci√≥n de texto en algunos elementos
    document.addEventListener('selectstart', function(e) {
      e.preventDefault();
      return false;
    });

    class UTMSimulation {
      constructor(){
        this.polygons = new Map();
        this.isRunning = true;
        this.startTime = new Date();
        this.lastUiUpdate = 0;
        this.uiIntervalMs = 1000;

        this.personasNaturales = [
          'Carlos Rodr√≠guez','Mar√≠a Garc√≠a','Jos√© Mart√≠nez','Ana L√≥pez',
          'Juan Hern√°ndez','Laura Gonz√°lez','Miguel P√©rez','Isabel S√°nchez',
          'Pedro Ram√≠rez','Carmen Torres','Fernando Flores','Elena Castro',
          'Ricardo Ortega','Sofia Mendoza','Javier Rojas','Patricia Vargas',
          'Alberto N√∫√±ez','Rosa Medina','Roberto Herrera','Teresa Guzm√°n'
        ];

       this.puntosValleCauca = [
  // Zonas urbanas de Cali
  { name:"Cali Centro",       lat:3.4516, lng:-76.5320, type:"urbana" },
  { name:"Cali Norte",        lat:3.4800, lng:-76.5200, type:"urbana" },
  { name:"Cali Sur",          lat:3.4200, lng:-76.5400, type:"urbana" },
  { name:"Cali Oriente",      lat:3.4500, lng:-76.5000, type:"urbana" },
  { name:"Cali Occidente",    lat:3.4400, lng:-76.5600, type:"urbana" },

  // Zonas alrededor de Cali
  { name:"Pance",             lat:3.3800, lng:-76.5800, type:"rural" },
  { name:"Menga",             lat:3.5200, lng:-76.5100, type:"rural" },
  { name:"Ca√±averalejo",      lat:3.4300, lng:-76.5200, type:"rural" },
  { name:"Aguacatal",         lat:3.4600, lng:-76.4800, type:"rural" },
  { name:"Villacarmelo",      lat:3.3500, lng:-76.6000, type:"rural" },
  { name:"Montebello",        lat:3.5300, lng:-76.4700, type:"rural" },
  { name:"El Hormiguero",     lat:3.4800, lng:-76.4400, type:"rural" },
  { name:"San Antonio",       lat:3.4450, lng:-76.5450, type:"rural" },
  { name:"San Fernando",      lat:3.4350, lng:-76.5350, type:"rural" },
  { name:"Granada",           lat:3.4550, lng:-76.5250, type:"rural" },
  { name:"Santa M√≥nica",      lat:3.4650, lng:-76.5150, type:"rural" },

  // Palmira y alrededores
  { name:"Palmira Centro",    lat:3.5394, lng:-76.3036, type:"urbana" },
  { name:"Palmira Norte",     lat:3.5600, lng:-76.3000, type:"urbana" },
  { name:"Palmira Sur",       lat:3.5200, lng:-76.3100, type:"urbana" },
  { name:"Palmira Este",      lat:3.5400, lng:-76.2800, type:"urbana" },
  { name:"Palmira Oeste",     lat:3.5350, lng:-76.3300, type:"urbana" },
  { name:"Cerrito",           lat:3.5800, lng:-76.2500, type:"rural" },
  { name:"Rozo",              lat:3.5100, lng:-76.3500, type:"rural" },
  { name:"Bolo La Italia",    lat:3.6000, lng:-76.3200, type:"rural" },
  { name:"Obando (Palmira)",  lat:3.6200, lng:-76.2800, type:"rural" },
  { name:"El Bungal",         lat:3.5500, lng:-76.2700, type:"rural" },
  { name:"La Rivera",         lat:3.5300, lng:-76.2600, type:"rural" },
  { name:"El Porvenir",       lat:3.5700, lng:-76.2900, type:"rural" },
  { name:"San Isidro",        lat:3.5900, lng:-76.3100, type:"rural" },
  { name:"La Esmeralda",      lat:3.5600, lng:-76.3400, type:"rural" },

  // Otras ciudades del Valle (existentes)
  { name:"Yumbo",             lat:3.5823, lng:-76.4914, type:"urbana" },
  { name:"Jamund√≠",           lat:3.2627, lng:-76.5430, type:"urbana" },
  { name:"Candelaria",        lat:3.4065, lng:-76.3485, type:"urbana" },
  { name:"Vijes",             lat:3.7000, lng:-76.4500, type:"rural" },
  { name:"Dagua",             lat:3.6500, lng:-76.7000, type:"rural" },
  { name:"La Cumbre",         lat:3.6500, lng:-76.5500, type:"rural" },
  { name:"Ginebra",           lat:3.7333, lng:-76.2667, type:"rural" },
  { name:"Guacar√≠",           lat:3.7667, lng:-76.3333, type:"rural" },
  { name:"Restrepo",          lat:3.8333, lng:-76.5000, type:"rural" },
  { name:"Riofr√≠o",           lat:4.1500, lng:-76.2833, type:"rural" },

  // M√°s zonas rurales - A√ëADIDAS M√ÅS ZONAS (existentes)
  { name:"El Placer",         lat:3.8500, lng:-76.3500, type:"rural" },
  { name:"La Paila",          lat:3.7800, lng:-76.2800, type:"rural" },
  { name:"Pradera",           lat:3.4211, lng:-76.2433, type:"rural" },
  { name:"Florida",           lat:3.3275, lng:-76.2386, type:"rural" },
  { name:"El Cerrito",        lat:3.6847, lng:-76.3136, type:"rural" },
  { name:"San Pedro",         lat:3.9956, lng:-76.2289, type:"rural" },
  { name:"Tulu√° Rural",       lat:4.0867, lng:-76.2000, type:"rural" },
  { name:"Andaluc√≠a",         lat:4.1703, lng:-76.1706, type:"rural" },
  { name:"Bugalagrande",      lat:4.2125, lng:-76.1556, type:"rural" },
  { name:"El √Åguila",         lat:4.9083, lng:-76.1167, type:"rural" },
  { name:"El Cairo",          lat:4.7600, lng:-76.2219, type:"rural" },
  { name:"La Celia",          lat:5.0033, lng:-76.0033, type:"rural" },
  { name:"Versalles",         lat:4.5750, lng:-76.1994, type:"rural" },
  { name:"Argelia",           lat:4.7278, lng:-76.1214, type:"rural" },
  { name:"El Danubio",        lat:3.8500, lng:-76.6500, type:"rural" },
  { name:"Cisneros",          lat:3.8500, lng:-76.9500, type:"rural" },
  { name:"Sabaletas",         lat:3.8000, lng:-77.0800, type:"rural" },
  { name:"Loboguerrero",      lat:3.9200, lng:-76.5200, type:"rural" },
  { name:"Queremal",          lat:3.5300, lng:-76.7000, type:"rural" },
  { name:"Aguaclara",         lat:3.6200, lng:-76.2800, type:"rural" },
  { name:"Mediacanoa",        lat:3.6800, lng:-76.3200, type:"rural" },
  { name:"La Sirena",         lat:3.5200, lng:-76.5900, type:"rural" },
  { name:"Los Andes",         lat:3.4800, lng:-76.5600, type:"rural" },
  { name:"La Castilla",       lat:3.5400, lng:-76.5400, type:"rural" },
  { name:"Montalvo",          lat:3.6200, lng:-76.4800, type:"rural" },
  { name:"Dapa",              lat:3.5800, lng:-76.5200, type:"rural" },
  { name:"Robles",            lat:3.2500, lng:-76.5300, type:"rural" },
  { name:"Villa Colombia",    lat:3.2200, lng:-76.5500, type:"rural" },
  { name:"Santa B√°rbara",     lat:3.4500, lng:-76.3800, type:"rural" },
  { name:"La Pampa",          lat:3.4200, lng:-76.3500, type:"rural" },
  { name:"La Marina",         lat:4.4500, lng:-76.1200, type:"rural" },
  { name:"Bol√≠var",           lat:4.3386, lng:-76.1842, type:"rural" },
  { name:"Parque Farallones", lat:3.4500, lng:-76.6500, type:"rural" },
  { name:"Reserva Pance",     lat:3.3500, lng:-76.6500, type:"rural" },
  { name:"Alto Anchicay√°",    lat:3.6000, lng:-76.8000, type:"rural" },
  { name:"San Cipriano",      lat:3.7200, lng:-76.9000, type:"rural" },
  { name:"Kil√≥metro 18",      lat:3.5500, lng:-76.7200, type:"rural" },
  { name:"La Elvira",         lat:3.4800, lng:-76.6200, type:"rural" },
  { name:"La Leonera",        lat:3.5100, lng:-76.5800, type:"rural" },
  { name:"El V√≠nculo",        lat:3.6100, lng:-76.2900, type:"rural" },
  { name:"Santa Elena",       lat:3.6400, lng:-76.2700, type:"rural" },
  { name:"Pichind√©",          lat:3.5200, lng:-76.6200, type:"rural" },

  // ===============================
  // NUEVOS MUNICIPIOS Y POL√çGONOS
  // ===============================

  // YUMBO ‚Äì 10 zonas
  { name:"Yumbo Zona 1", lat:3.5850, lng:-76.4950, type:"urbana" },
  { name:"Yumbo Zona 2", lat:3.5900, lng:-76.4850, type:"urbana" },
  { name:"Yumbo Zona 3", lat:3.5750, lng:-76.5000, type:"urbana" },
  { name:"Yumbo Zona 4", lat:3.5950, lng:-76.5050, type:"urbana" },
  { name:"Yumbo Zona 5", lat:3.5800, lng:-76.4800, type:"urbana" },
  { name:"Yumbo Zona 6", lat:3.6000, lng:-76.4700, type:"rural" },
  { name:"Yumbo Zona 7", lat:3.5650, lng:-76.5100, type:"rural" },
  { name:"Yumbo Zona 8", lat:3.5700, lng:-76.4750, type:"rural" },
  { name:"Yumbo Zona 9", lat:3.6100, lng:-76.4900, type:"rural" },
  { name:"Yumbo Zona 10",lat:3.5550, lng:-76.4850, type:"rural" },

  { name:"Yumbo Zona 11", lat:3.5960, lng:-76.4890, type:"urbana" },
  { name:"Yumbo Zona 12", lat:3.5925, lng:-76.5025, type:"urbana" },
  { name:"Yumbo Zona 13", lat:3.5860, lng:-76.5090, type:"urbana" },
  { name:"Yumbo Zona 14", lat:3.5785, lng:-76.5060, type:"urbana" },
  { name:"Yumbo Zona 15", lat:3.5730, lng:-76.4975, type:"urbana" },
  { name:"Yumbo Zona 16", lat:3.5755, lng:-76.4865, type:"urbana" },
  { name:"Yumbo Zona 17", lat:3.5830, lng:-76.4805, type:"urbana" },
  { name:"Yumbo Zona 18", lat:3.5920, lng:-76.4815, type:"urbana" },
  { name:"Yumbo Zona 19", lat:3.6000, lng:-76.4930, type:"urbana" },
  { name:"Yumbo Zona 20", lat:3.5885, lng:-76.4985, type:"urbana" },

  // Rurales (anillo externo, m√°s separados)
  { name:"Yumbo Zona 21", lat:3.6075, lng:-76.5065, type:"rural" },
  { name:"Yumbo Zona 22", lat:3.6030, lng:-76.5210, type:"rural" },
  { name:"Yumbo Zona 23", lat:3.5905, lng:-76.5235, type:"rural" },
  { name:"Yumbo Zona 24", lat:3.5760, lng:-76.5190, type:"rural" },
  { name:"Yumbo Zona 25", lat:3.5635, lng:-76.5070, type:"rural" },
  { name:"Yumbo Zona 26", lat:3.5600, lng:-76.4925, type:"rural" },
  { name:"Yumbo Zona 27", lat:3.5655, lng:-76.4780, type:"rural" },
  { name:"Yumbo Zona 28", lat:3.5800, lng:-76.4685, type:"rural" },
  { name:"Yumbo Zona 29", lat:3.5975, lng:-76.4725, type:"rural" },
  { name:"Yumbo Zona 30", lat:3.6100, lng:-76.4880, type:"rural" },

  // JAMUND√ç ‚Äì 10 zonas
  { name:"Jamund√≠ Zona 1", lat:3.2650, lng:-76.5450, type:"urbana" },
  { name:"Jamund√≠ Zona 2", lat:3.2700, lng:-76.5350, type:"urbana" },
  { name:"Jamund√≠ Zona 3", lat:3.2550, lng:-76.5500, type:"urbana" },
  { name:"Jamund√≠ Zona 4", lat:3.2750, lng:-76.5550, type:"urbana" },
  { name:"Jamund√≠ Zona 5", lat:3.2600, lng:-76.5300, type:"urbana" },
  { name:"Jamund√≠ Zona 6", lat:3.2400, lng:-76.5700, type:"rural" },
  { name:"Jamund√≠ Zona 7", lat:3.2500, lng:-76.5200, type:"rural" },
  { name:"Jamund√≠ Zona 8", lat:3.2800, lng:-76.5200, type:"rural" },
  { name:"Jamund√≠ Zona 9", lat:3.3000, lng:-76.5600, type:"rural" },
  { name:"Jamund√≠ Zona 10",lat:3.2300, lng:-76.5900, type:"rural" },

  { name:"Jamund√≠ Zona 11", lat:3.2720, lng:-76.5480, type:"urbana" },
  { name:"Jamund√≠ Zona 12", lat:3.2685, lng:-76.5555, type:"urbana" },
  { name:"Jamund√≠ Zona 13", lat:3.2605, lng:-76.5600, type:"urbana" },
  { name:"Jamund√≠ Zona 14", lat:3.2520, lng:-76.5530, type:"urbana" },
  { name:"Jamund√≠ Zona 15", lat:3.2475, lng:-76.5420, type:"urbana" },
  { name:"Jamund√≠ Zona 16", lat:3.2525, lng:-76.5320, type:"urbana" },
  { name:"Jamund√≠ Zona 17", lat:3.2620, lng:-76.5250, type:"urbana" },
  { name:"Jamund√≠ Zona 18", lat:3.2735, lng:-76.5280, type:"urbana" },
  { name:"Jamund√≠ Zona 19", lat:3.2805, lng:-76.5400, type:"urbana" },
  { name:"Jamund√≠ Zona 20", lat:3.2580, lng:-76.5450, type:"urbana" },

  // Rurales (anillo externo disperso)
  { name:"Jamund√≠ Zona 21", lat:3.3000, lng:-76.5750, type:"rural" },
  { name:"Jamund√≠ Zona 22", lat:3.2850, lng:-76.5900, type:"rural" },
  { name:"Jamund√≠ Zona 23", lat:3.2700, lng:-76.6000, type:"rural" },
  { name:"Jamund√≠ Zona 24", lat:3.2500, lng:-76.6050, type:"rural" },
  { name:"Jamund√≠ Zona 25", lat:3.2350, lng:-76.6000, type:"rural" },
  { name:"Jamund√≠ Zona 26", lat:3.2250, lng:-76.5800, type:"rural" },
  { name:"Jamund√≠ Zona 27", lat:3.2300, lng:-76.5550, type:"rural" },
  { name:"Jamund√≠ Zona 28", lat:3.2400, lng:-76.5150, type:"rural" },
  { name:"Jamund√≠ Zona 29", lat:3.2650, lng:-76.5100, type:"rural" },
  { name:"Jamund√≠ Zona 30", lat:3.2950, lng:-76.5250, type:"rural" },

  // CANDELARIA ‚Äì 10 zonas
  { name:"Candelaria Zona 1", lat:3.4100, lng:-76.3500, type:"urbana" },
  { name:"Candelaria Zona 2", lat:3.4150, lng:-76.3400, type:"urbana" },
  { name:"Candelaria Zona 3", lat:3.4000, lng:-76.3550, type:"urbana" },
  { name:"Candelaria Zona 4", lat:3.4200, lng:-76.3600, type:"urbana" },
  { name:"Candelaria Zona 5", lat:3.4050, lng:-76.3300, type:"urbana" },
  { name:"Candelaria Zona 6", lat:3.3900, lng:-76.3700, type:"rural" },
  { name:"Candelaria Zona 7", lat:3.4300, lng:-76.3450, type:"rural" },
  { name:"Candelaria Zona 8", lat:3.3950, lng:-76.3200, type:"rural" },
  { name:"Candelaria Zona 9", lat:3.4400, lng:-76.3550, type:"rural" },
  { name:"Candelaria Zona 10",lat:3.3800, lng:-76.3400, type:"rural" },

  { name:"Candelaria Zona 11", lat:3.4170, lng:-76.3580, type:"urbana" },
  { name:"Candelaria Zona 12", lat:3.4125, lng:-76.3650, type:"urbana" },
  { name:"Candelaria Zona 13", lat:3.4050, lng:-76.3685, type:"urbana" },
  { name:"Candelaria Zona 14", lat:3.3970, lng:-76.3620, type:"urbana" },
  { name:"Candelaria Zona 15", lat:3.3925, lng:-76.3505, type:"urbana" },
  { name:"Candelaria Zona 16", lat:3.3955, lng:-76.3380, type:"urbana" },
  { name:"Candelaria Zona 17", lat:3.4030, lng:-76.3305, type:"urbana" },
  { name:"Candelaria Zona 18", lat:3.4140, lng:-76.3275, type:"urbana" },
  { name:"Candelaria Zona 19", lat:3.4225, lng:-76.3355, type:"urbana" },
  { name:"Candelaria Zona 20", lat:3.4085, lng:-76.3450, type:"urbana" },

  // Rurales (anillo externo)
  { name:"Candelaria Zona 21", lat:3.4500, lng:-76.3700, type:"rural" },
  { name:"Candelaria Zona 22", lat:3.4400, lng:-76.3900, type:"rural" },
  { name:"Candelaria Zona 23", lat:3.4200, lng:-76.4000, type:"rural" },
  { name:"Candelaria Zona 24", lat:3.3950, lng:-76.4050, type:"rural" },
  { name:"Candelaria Zona 25", lat:3.3750, lng:-76.3950, type:"rural" },
  { name:"Candelaria Zona 26", lat:3.3650, lng:-76.3750, type:"rural" },
  { name:"Candelaria Zona 27", lat:3.3700, lng:-76.3500, type:"rural" },
  { name:"Candelaria Zona 28", lat:3.3800, lng:-76.3150, type:"rural" },
  { name:"Candelaria Zona 29", lat:3.4050, lng:-76.3050, type:"rural" },
  { name:"Candelaria Zona 30", lat:3.4350, lng:-76.3200, type:"rural" },

  // BUENAVENTURA ‚Äì 10 zonas
  { name:"Buenaventura Zona 1", lat:3.8850, lng:-77.0050, type:"urbana" },
  { name:"Buenaventura Zona 2", lat:3.8950, lng:-76.9950, type:"urbana" },
  { name:"Buenaventura Zona 3", lat:3.8750, lng:-77.0100, type:"urbana" },
  { name:"Buenaventura Zona 4", lat:3.9000, lng:-77.0200, type:"urbana" },
  { name:"Buenaventura Zona 5", lat:3.8900, lng:-76.9850, type:"urbana" },
  { name:"Buenaventura Zona 6", lat:3.8600, lng:-77.0300, type:"rural" },
  { name:"Buenaventura Zona 7", lat:3.9100, lng:-77.0000, type:"rural" },
  { name:"Buenaventura Zona 8", lat:3.8700, lng:-76.9700, type:"rural" },
  { name:"Buenaventura Zona 9", lat:3.9150, lng:-77.0400, type:"rural" },
  { name:"Buenaventura Zona 10",lat:3.8450, lng:-77.0150, type:"rural" },

  { name:"Buenaventura Zona 11", lat:3.8980, lng:-77.0120, type:"urbana" },
  { name:"Buenaventura Zona 12", lat:3.8925, lng:-77.0225, type:"urbana" },
  { name:"Buenaventura Zona 13", lat:3.8840, lng:-77.0180, type:"urbana" },
  { name:"Buenaventura Zona 14", lat:3.8755, lng:-77.0055, type:"urbana" },
  { name:"Buenaventura Zona 15", lat:3.8805, lng:-76.9920, type:"urbana" },
  { name:"Buenaventura Zona 16", lat:3.8920, lng:-76.9800, type:"urbana" },
  { name:"Buenaventura Zona 17", lat:3.9050, lng:-76.9870, type:"urbana" },
  { name:"Buenaventura Zona 18", lat:3.9100, lng:-77.0100, type:"urbana" },
  { name:"Buenaventura Zona 19", lat:3.8995, lng:-77.0300, type:"urbana" },
  { name:"Buenaventura Zona 20", lat:3.8800, lng:-77.0255, type:"urbana" },

  // Rurales (anillo externo y costa)
  { name:"Buenaventura Zona 21", lat:3.9300, lng:-77.0500, type:"rural" },
  { name:"Buenaventura Zona 22", lat:3.9500, lng:-77.0700, type:"rural" },
  { name:"Buenaventura Zona 23", lat:3.9050, lng:-77.0750, type:"rural" },
  { name:"Buenaventura Zona 24", lat:3.8800, lng:-77.0850, type:"rural" },
  { name:"Buenaventura Zona 25", lat:3.8550, lng:-77.0800, type:"rural" },
  { name:"Buenaventura Zona 26", lat:3.8300, lng:-77.0600, type:"rural" },
  { name:"Buenaventura Zona 27", lat:3.8150, lng:-77.0300, type:"rural" },
  { name:"Buenaventura Zona 28", lat:3.8250, lng:-76.9950, type:"rural" },
  { name:"Buenaventura Zona 29", lat:3.8500, lng:-76.9650, type:"rural" },
  { name:"Buenaventura Zona 30", lat:3.8900, lng:-76.9500, type:"rural" },

  // TULU√Å ‚Äì 10 zonas
  { name:"Tulu√° Zona 1", lat:4.0900, lng:-76.1950, type:"urbana" },
  { name:"Tulu√° Zona 2", lat:4.0950, lng:-76.1850, type:"urbana" },
  { name:"Tulu√° Zona 3", lat:4.0800, lng:-76.2050, type:"urbana" },
  { name:"Tulu√° Zona 4", lat:4.1000, lng:-76.2100, type:"urbana" },
  { name:"Tulu√° Zona 5", lat:4.0850, lng:-76.1800, type:"urbana" },
  { name:"Tulu√° Zona 6", lat:4.1100, lng:-76.2200, type:"rural" },
  { name:"Tulu√° Zona 7", lat:4.0700, lng:-76.2250, type:"rural" },
  { name:"Tulu√° Zona 8", lat:4.1200, lng:-76.2000, type:"rural" },
  { name:"Tulu√° Zona 9", lat:4.0600, lng:-76.1900, type:"rural" },
  { name:"Tulu√° Zona 10",lat:4.0950, lng:-76.2350, type:"rural" },

  { name:"Tulu√° Zona 11", lat:4.1020, lng:-76.1970, type:"urbana" },
  { name:"Tulu√° Zona 12", lat:4.0970, lng:-76.2055, type:"urbana" },
  { name:"Tulu√° Zona 13", lat:4.0890, lng:-76.2120, type:"urbana" },
  { name:"Tulu√° Zona 14", lat:4.0805, lng:-76.1980, type:"urbana" },
  { name:"Tulu√° Zona 15", lat:4.0875, lng:-76.1900, type:"urbana" },
  { name:"Tulu√° Zona 16", lat:4.0950, lng:-76.1750, type:"urbana" },
  { name:"Tulu√° Zona 17", lat:4.1050, lng:-76.1825, type:"urbana" },
  { name:"Tulu√° Zona 18", lat:4.1105, lng:-76.1950, type:"urbana" },
  { name:"Tulu√° Zona 19", lat:4.0985, lng:-76.2200, type:"urbana" },
  { name:"Tulu√° Zona 20", lat:4.0830, lng:-76.2205, type:"urbana" },

  // Rurales (anillo externo)
  { name:"Tulu√° Zona 21", lat:4.1300, lng:-76.2400, type:"rural" },
  { name:"Tulu√° Zona 22", lat:4.1150, lng:-76.2550, type:"rural" },
  { name:"Tulu√° Zona 23", lat:4.0950, lng:-76.2600, type:"rural" },
  { name:"Tulu√° Zona 24", lat:4.0700, lng:-76.2550, type:"rural" },
  { name:"Tulu√° Zona 25", lat:4.0550, lng:-76.2400, type:"rural" },
  { name:"Tulu√° Zona 26", lat:4.0500, lng:-76.2150, type:"rural" },
  { name:"Tulu√° Zona 27", lat:4.0550, lng:-76.1850, type:"rural" },
  { name:"Tulu√° Zona 28", lat:4.0700, lng:-76.1650, type:"rural" },
  { name:"Tulu√° Zona 29", lat:4.1000, lng:-76.1600, type:"rural" },
  { name:"Tulu√° Zona 30", lat:4.1200, lng:-76.1750, type:"rural" },

  // BUGA ‚Äì 10 zonas
  { name:"Buga Zona 1", lat:3.9050, lng:-76.3000, type:"urbana" },
  { name:"Buga Zona 2", lat:3.9100, lng:-76.2900, type:"urbana" },
  { name:"Buga Zona 3", lat:3.8950, lng:-76.3050, type:"urbana" },
  { name:"Buga Zona 4", lat:3.9150, lng:-76.3100, type:"urbana" },
  { name:"Buga Zona 5", lat:3.9000, lng:-76.2850, type:"urbana" },
  { name:"Buga Zona 6", lat:3.9250, lng:-76.3200, type:"rural" },
  { name:"Buga Zona 7", lat:3.8800, lng:-76.3300, type:"rural" },
  { name:"Buga Zona 8", lat:3.9350, lng:-76.2950, type:"rural" },
  { name:"Buga Zona 9", lat:3.8900, lng:-76.2750, type:"rural" },
  { name:"Buga Zona 10",lat:3.9200, lng:-76.3400, type:"rural" },

  { name:"Buga Zona 11", lat:3.9085, lng:-76.3055, type:"urbana" },
  { name:"Buga Zona 12", lat:3.9120, lng:-76.3150, type:"urbana" },
  { name:"Buga Zona 13", lat:3.9000, lng:-76.3180, type:"urbana" },
  { name:"Buga Zona 14", lat:3.8920, lng:-76.3105, type:"urbana" },
  { name:"Buga Zona 15", lat:3.8880, lng:-76.2980, type:"urbana" },
  { name:"Buga Zona 16", lat:3.8935, lng:-76.2880, type:"urbana" },
  { name:"Buga Zona 17", lat:3.9040, lng:-76.2800, type:"urbana" },
  { name:"Buga Zona 18", lat:3.9165, lng:-76.2835, type:"urbana" },
  { name:"Buga Zona 19", lat:3.9225, lng:-76.2955, type:"urbana" },
  { name:"Buga Zona 20", lat:3.9055, lng:-76.2920, type:"urbana" },

  // Rurales (anillo externo)
  { name:"Buga Zona 21", lat:3.9400, lng:-76.3250, type:"rural" },
  { name:"Buga Zona 22", lat:3.9500, lng:-76.3450, type:"rural" },
  { name:"Buga Zona 23", lat:3.9300, lng:-76.3600, type:"rural" },
  { name:"Buga Zona 24", lat:3.9050, lng:-76.3650, type:"rural" },
  { name:"Buga Zona 25", lat:3.8800, lng:-76.3600, type:"rural" },
  { name:"Buga Zona 26", lat:3.8650, lng:-76.3400, type:"rural" },
  { name:"Buga Zona 27", lat:3.8600, lng:-76.3100, type:"rural" },
  { name:"Buga Zona 28", lat:3.8700, lng:-76.2750, type:"rural" },
  { name:"Buga Zona 29", lat:3.8950, lng:-76.2600, type:"rural" },
  { name:"Buga Zona 30", lat:3.9200, lng:-76.2550, type:"rural" },

  // CARTAGO ‚Äì 10 zonas
  { name:"Cartago Zona 1", lat:4.7480, lng:-75.9150, type:"urbana" },
  { name:"Cartago Zona 2", lat:4.7520, lng:-75.9050, type:"urbana" },
  { name:"Cartago Zona 3", lat:4.7400, lng:-75.9200, type:"urbana" },
  { name:"Cartago Zona 4", lat:4.7580, lng:-75.9250, type:"urbana" },
  { name:"Cartago Zona 5", lat:4.7460, lng:-75.9000, type:"urbana" },
  { name:"Cartago Zona 6", lat:4.7650, lng:-75.9400, type:"rural" },
  { name:"Cartago Zona 7", lat:4.7350, lng:-75.9450, type:"rural" },
  { name:"Cartago Zona 8", lat:4.7720, lng:-75.9150, type:"rural" },
  { name:"Cartago Zona 9", lat:4.7280, lng:-75.9050, type:"rural" },
  { name:"Cartago Zona 10",lat:4.7550, lng:-75.9550, type:"rural" },

  { name:"Cartago Zona 11", lat:4.7540, lng:-75.9200, type:"urbana" },
  { name:"Cartago Zona 12", lat:4.7600, lng:-75.9105, type:"urbana" },
  { name:"Cartago Zona 13", lat:4.7485, lng:-75.9300, type:"urbana" },
  { name:"Cartago Zona 14", lat:4.7420, lng:-75.9100, type:"urbana" },
  { name:"Cartago Zona 15", lat:4.7385, lng:-75.9005, type:"urbana" },
  { name:"Cartago Zona 16", lat:4.7455, lng:-75.8920, type:"urbana" },
  { name:"Cartago Zona 17", lat:4.7560, lng:-75.8950, type:"urbana" },
  { name:"Cartago Zona 18", lat:4.7640, lng:-75.9025, type:"urbana" },
  { name:"Cartago Zona 19", lat:4.7705, lng:-75.9250, type:"urbana" },
  { name:"Cartago Zona 20", lat:4.7500, lng:-75.9355, type:"urbana" },

  // Rurales (anillo externo)
  { name:"Cartago Zona 21", lat:4.7850, lng:-75.9450, type:"rural" },
  { name:"Cartago Zona 22", lat:4.8000, lng:-75.9700, type:"rural" },
  { name:"Cartago Zona 23", lat:4.7700, lng:-75.9800, type:"rural" },
  { name:"Cartago Zona 24", lat:4.7450, lng:-75.9900, type:"rural" },
  { name:"Cartago Zona 25", lat:4.7200, lng:-75.9750, type:"rural" },
  { name:"Cartago Zona 26", lat:4.7100, lng:-75.9500, type:"rural" },
  { name:"Cartago Zona 27", lat:4.7150, lng:-75.9150, type:"rural" },
  { name:"Cartago Zona 28", lat:4.7250, lng:-75.8850, type:"rural" },
  { name:"Cartago Zona 29", lat:4.7550, lng:-75.8800, type:"rural" },
  { name:"Cartago Zona 30", lat:4.7800, lng:-75.8950, type:"rural" },

  // ROLDANILLO ‚Äì 10 zonas
  { name:"Roldanillo Zona 1", lat:4.4170, lng:-76.1550, type:"urbana" },
  { name:"Roldanillo Zona 2", lat:4.4200, lng:-76.1450, type:"urbana" },
  { name:"Roldanillo Zona 3", lat:4.4100, lng:-76.1600, type:"urbana" },
  { name:"Roldanillo Zona 4", lat:4.4250, lng:-76.1650, type:"urbana" },
  { name:"Roldanillo Zona 5", lat:4.4150, lng:-76.1400, type:"urbana" },
  { name:"Roldanillo Zona 6", lat:4.4350, lng:-76.1750, type:"rural" },
  { name:"Roldanillo Zona 7", lat:4.4000, lng:-76.1800, type:"rural" },
  { name:"Roldanillo Zona 8", lat:4.4450, lng:-76.1550, type:"rural" },
  { name:"Roldanillo Zona 9", lat:4.3950, lng:-76.1400, type:"rural" },
  { name:"Roldanillo Zona 10",lat:4.4300, lng:-76.1850, type:"rural" },

  { name:"Roldanillo Zona 11", lat:4.4220, lng:-76.1580, type:"urbana" },
  { name:"Roldanillo Zona 12", lat:4.4180, lng:-76.1670, type:"urbana" },
  { name:"Roldanillo Zona 13", lat:4.4105, lng:-76.1705, type:"urbana" },
  { name:"Roldanillo Zona 14", lat:4.4040, lng:-76.1620, type:"urbana" },
  { name:"Roldanillo Zona 15", lat:4.4055, lng:-76.1500, type:"urbana" },
  { name:"Roldanillo Zona 16", lat:4.4100, lng:-76.1420, type:"urbana" },
  { name:"Roldanillo Zona 17", lat:4.4205, lng:-76.1355, type:"urbana" },
  { name:"Roldanillo Zona 18", lat:4.4300, lng:-76.1400, type:"urbana" },
  { name:"Roldanillo Zona 19", lat:4.4330, lng:-76.1505, type:"urbana" },
  { name:"Roldanillo Zona 20", lat:4.4235, lng:-76.1505, type:"urbana" },

  // Rurales (anillo externo)
  { name:"Roldanillo Zona 21", lat:4.4500, lng:-76.1800, type:"rural" },
  { name:"Roldanillo Zona 22", lat:4.4650, lng:-76.2000, type:"rural" },
  { name:"Roldanillo Zona 23", lat:4.4400, lng:-76.2100, type:"rural" },
  { name:"Roldanillo Zona 24", lat:4.4150, lng:-76.2150, type:"rural" },
  { name:"Roldanillo Zona 25", lat:4.3900, lng:-76.2050, type:"rural" },
  { name:"Roldanillo Zona 26", lat:4.3800, lng:-76.1750, type:"rural" },
  { name:"Roldanillo Zona 27", lat:4.3850, lng:-76.1450, type:"rural" },
  { name:"Roldanillo Zona 28", lat:4.3950, lng:-76.1200, type:"rural" },
  { name:"Roldanillo Zona 29", lat:4.4200, lng:-76.1150, type:"rural" },
  { name:"Roldanillo Zona 30", lat:4.4450, lng:-76.1300, type:"rural" },


  // ZARZAL ‚Äì 10 zonas
  { name:"Zarzal Zona 1", lat:4.3970, lng:-76.0725, type:"urbana" },
  { name:"Zarzal Zona 2", lat:4.4020, lng:-76.0620, type:"urbana" },
  { name:"Zarzal Zona 3", lat:4.3880, lng:-76.0800, type:"urbana" },
  { name:"Zarzal Zona 4", lat:4.4080, lng:-76.0850, type:"urbana" },
  { name:"Zarzal Zona 5", lat:4.3920, lng:-76.0600, type:"urbana" },
  { name:"Zarzal Zona 6", lat:4.4180, lng:-76.0950, type:"rural" },
  { name:"Zarzal Zona 7", lat:4.3800, lng:-76.1000, type:"rural" },
  { name:"Zarzal Zona 8", lat:4.4250, lng:-76.0700, type:"rural" },
  { name:"Zarzal Zona 9", lat:4.3720, lng:-76.0600, type:"rural" },
  { name:"Zarzal Zona 10",lat:4.4100, lng:-76.1100, type:"rural" },

  { name:"Zarzal Zona 11", lat:4.4050, lng:-76.0750, type:"urbana" },
  { name:"Zarzal Zona 12", lat:4.3995, lng:-76.0830, type:"urbana" },
  { name:"Zarzal Zona 13", lat:4.3900, lng:-76.0880, type:"urbana" },
  { name:"Zarzal Zona 14", lat:4.3840, lng:-76.0720, type:"urbana" },
  { name:"Zarzal Zona 15", lat:4.3865, lng:-76.0635, type:"urbana" },
  { name:"Zarzal Zona 16", lat:4.3920, lng:-76.0550, type:"urbana" },
  { name:"Zarzal Zona 17", lat:4.4020, lng:-76.0520, type:"urbana" },
  { name:"Zarzal Zona 18", lat:4.4100, lng:-76.0585, type:"urbana" },
  { name:"Zarzal Zona 19", lat:4.4135, lng:-76.0680, type:"urbana" },
  { name:"Zarzal Zona 20", lat:4.4005, lng:-76.0705, type:"urbana" },

  // Rurales (anillo externo)
  { name:"Zarzal Zona 21", lat:4.4300, lng:-76.1000, type:"rural" },
  { name:"Zarzal Zona 22", lat:4.4450, lng:-76.1250, type:"rural" },
  { name:"Zarzal Zona 23", lat:4.4200, lng:-76.1400, type:"rural" },
  { name:"Zarzal Zona 24", lat:4.3950, lng:-76.1450, type:"rural" },
  { name:"Zarzal Zona 25", lat:4.3700, lng:-76.1400, type:"rural" },
  { name:"Zarzal Zona 26", lat:4.3600, lng:-76.1150, type:"rural" },
  { name:"Zarzal Zona 27", lat:4.3650, lng:-76.0850, type:"rural" },
  { name:"Zarzal Zona 28", lat:4.3750, lng:-76.0500, type:"rural" },
  { name:"Zarzal Zona 29", lat:4.4000, lng:-76.0400, type:"rural" },
  { name:"Zarzal Zona 30", lat:4.4250, lng:-76.0450, type:"rural" },

  // LA UNI√ìN ‚Äì 10 zonas
  { name:"La Uni√≥n Zona 1", lat:4.5350, lng:-76.1050, type:"urbana" },
  { name:"La Uni√≥n Zona 2", lat:4.5400, lng:-76.0950, type:"urbana" },
  { name:"La Uni√≥n Zona 3", lat:4.5280, lng:-76.1120, type:"urbana" },
  { name:"La Uni√≥n Zona 4", lat:4.5480, lng:-76.1180, type:"urbana" },
  { name:"La Uni√≥n Zona 5", lat:4.5320, lng:-76.0900, type:"urbana" },
  { name:"La Uni√≥n Zona 6", lat:4.5550, lng:-76.1250, type:"rural" },
  { name:"La Uni√≥n Zona 7", lat:4.5150, lng:-76.1350, type:"rural" },
  { name:"La Uni√≥n Zona 8", lat:4.5650, lng:-76.1050, type:"rural" },
  { name:"La Uni√≥n Zona 9", lat:4.5080, lng:-76.0950, type:"rural" },
  { name:"La Uni√≥n Zona 10",lat:4.5450, lng:-76.1450, type:"rural" },

  { name:"La Uni√≥n Zona 11", lat:4.5420, lng:-76.1100, type:"urbana" },
  { name:"La Uni√≥n Zona 12", lat:4.5385, lng:-76.1185, type:"urbana" },
  { name:"La Uni√≥n Zona 13", lat:4.5300, lng:-76.1205, type:"urbana" },
  { name:"La Uni√≥n Zona 14", lat:4.5230, lng:-76.1130, type:"urbana" },
  { name:"La Uni√≥n Zona 15", lat:4.5250, lng:-76.1020, type:"urbana" },
  { name:"La Uni√≥n Zona 16", lat:4.5305, lng:-76.0950, type:"urbana" },
  { name:"La Uni√≥n Zona 17", lat:4.5405, lng:-76.0880, type:"urbana" },
  { name:"La Uni√≥n Zona 18", lat:4.5500, lng:-76.0925, type:"urbana" },
  { name:"La Uni√≥n Zona 19", lat:4.5525, lng:-76.1020, type:"urbana" },
  { name:"La Uni√≥n Zona 20", lat:4.5400, lng:-76.1025, type:"urbana" },

  // Rurales (anillo externo)
  { name:"La Uni√≥n Zona 21", lat:4.5700, lng:-76.1300, type:"rural" },
  { name:"La Uni√≥n Zona 22", lat:4.5900, lng:-76.1500, type:"rural" },
  { name:"La Uni√≥n Zona 23", lat:4.5650, lng:-76.1650, type:"rural" },
  { name:"La Uni√≥n Zona 24", lat:4.5400, lng:-76.1750, type:"rural" },
  { name:"La Uni√≥n Zona 25", lat:4.5150, lng:-76.1700, type:"rural" },
  { name:"La Uni√≥n Zona 26", lat:4.5000, lng:-76.1500, type:"rural" },
  { name:"La Uni√≥n Zona 27", lat:4.5030, lng:-76.1150, type:"rural" },
  { name:"La Uni√≥n Zona 28", lat:4.5100, lng:-76.0800, type:"rural" },
  { name:"La Uni√≥n Zona 29", lat:4.5350, lng:-76.0700, type:"rural" },
  { name:"La Uni√≥n Zona 30", lat:4.5620, lng:-76.0800, type:"rural" },

  // SEVILLA ‚Äì 10 zonas
  { name:"Sevilla Zona 1", lat:4.2660, lng:-75.9380, type:"urbana" },
  { name:"Sevilla Zona 2", lat:4.2710, lng:-75.9280, type:"urbana" },
  { name:"Sevilla Zona 3", lat:4.2580, lng:-75.9450, type:"urbana" },
  { name:"Sevilla Zona 4", lat:4.2780, lng:-75.9500, type:"urbana" },
  { name:"Sevilla Zona 5", lat:4.2640, lng:-75.9220, type:"urbana" },
  { name:"Sevilla Zona 6", lat:4.2900, lng:-75.9600, type:"rural" },
  { name:"Sevilla Zona 7", lat:4.2450, lng:-75.9700, type:"rural" },
  { name:"Sevilla Zona 8", lat:4.3000, lng:-75.9350, type:"rural" },
  { name:"Sevilla Zona 9", lat:4.2380, lng:-75.9250, type:"rural" },
  { name:"Sevilla Zona 10",lat:4.2750, lng:-75.9800, type:"rural" },

  { name:"Sevilla Zona 11", lat:4.2735, lng:-75.9405, type:"urbana" },
  { name:"Sevilla Zona 12", lat:4.2700, lng:-75.9500, type:"urbana" },
  { name:"Sevilla Zona 13", lat:4.2630, lng:-75.9550, type:"urbana" },
  { name:"Sevilla Zona 14", lat:4.2540, lng:-75.9470, type:"urbana" },
  { name:"Sevilla Zona 15", lat:4.2525, lng:-75.9350, type:"urbana" },
  { name:"Sevilla Zona 16", lat:4.2570, lng:-75.9270, type:"urbana" },
  { name:"Sevilla Zona 17", lat:4.2665, lng:-75.9200, type:"urbana" },
  { name:"Sevilla Zona 18", lat:4.2770, lng:-75.9235, type:"urbana" },
  { name:"Sevilla Zona 19", lat:4.2825, lng:-75.9320, type:"urbana" },
  { name:"Sevilla Zona 20", lat:4.2720, lng:-75.9350, type:"urbana" },

  // Rurales (anillo externo)
  { name:"Sevilla Zona 21", lat:4.3050, lng:-75.9650, type:"rural" },
  { name:"Sevilla Zona 22", lat:4.3200, lng:-75.9900, type:"rural" },
  { name:"Sevilla Zona 23", lat:4.2900, lng:-76.0050, type:"rural" },
  { name:"Sevilla Zona 24", lat:4.2600, lng:-76.0100, type:"rural" },
  { name:"Sevilla Zona 25", lat:4.2400, lng:-75.9950, type:"rural" },
  { name:"Sevilla Zona 26", lat:4.2250, lng:-75.9600, type:"rural" },
  { name:"Sevilla Zona 27", lat:4.2300, lng:-75.9200, type:"rural" },
  { name:"Sevilla Zona 28", lat:4.2450, lng:-75.9000, type:"rural" },
  { name:"Sevilla Zona 29", lat:4.2700, lng:-75.8900, type:"rural" },
  { name:"Sevilla Zona 30", lat:4.2950, lng:-75.9050, type:"rural" },

  // CAICEDONIA ‚Äì 10 zonas
  { name:"Caicedonia Zona 1", lat:4.3350, lng:-75.8300, type:"urbana" },
  { name:"Caicedonia Zona 2", lat:4.3400, lng:-75.8200, type:"urbana" },
  { name:"Caicedonia Zona 3", lat:4.3280, lng:-75.8380, type:"urbana" },
  { name:"Caicedonia Zona 4", lat:4.3480, lng:-75.8420, type:"urbana" },
  { name:"Caicedonia Zona 5", lat:4.3330, lng:-75.8150, type:"urbana" },
  { name:"Caicedonia Zona 6", lat:4.3600, lng:-75.8520, type:"rural" },
  { name:"Caicedonia Zona 7", lat:4.3180, lng:-75.8600, type:"rural" },
  { name:"Caicedonia Zona 8", lat:4.3700, lng:-75.8300, type:"rural" },
  { name:"Caicedonia Zona 9", lat:4.3100, lng:-75.8200, type:"rural" },
  { name:"Caicedonia Zona 10",lat:4.3500, lng:-75.8700, type:"rural" },

  { name:"Caicedonia Zona 11", lat:4.3420, lng:-75.8350, type:"urbana" },
  { name:"Caicedonia Zona 12", lat:4.3380, lng:-75.8450, type:"urbana" },
  { name:"Caicedonia Zona 13", lat:4.3305, lng:-75.8500, type:"urbana" },
  { name:"Caicedonia Zona 14", lat:4.3225, lng:-75.8425, type:"urbana" },
  { name:"Caicedonia Zona 15", lat:4.3250, lng:-75.8280, type:"urbana" },
  { name:"Caicedonia Zona 16", lat:4.3300, lng:-75.8185, type:"urbana" },
  { name:"Caicedonia Zona 17", lat:4.3385, lng:-75.8120, type:"urbana" },
  { name:"Caicedonia Zona 18", lat:4.3480, lng:-75.8180, type:"urbana" },
  { name:"Caicedonia Zona 19", lat:4.3525, lng:-75.8285, type:"urbana" },
  { name:"Caicedonia Zona 20", lat:4.3400, lng:-75.8305, type:"urbana" },

  // Rurales (anillo externo)
  { name:"Caicedonia Zona 21", lat:4.3800, lng:-75.8550, type:"rural" },
  { name:"Caicedonia Zona 22", lat:4.3950, lng:-75.8800, type:"rural" },
  { name:"Caicedonia Zona 23", lat:4.3680, lng:-75.8950, type:"rural" },
  { name:"Caicedonia Zona 24", lat:4.3450, lng:-75.9050, type:"rural" },
  { name:"Caicedonia Zona 25", lat:4.3200, lng:-75.9000, type:"rural" },
  { name:"Caicedonia Zona 26", lat:4.3000, lng:-75.8750, type:"rural" },
  { name:"Caicedonia Zona 27", lat:4.3050, lng:-75.8450, type:"rural" },
  { name:"Caicedonia Zona 28", lat:4.3150, lng:-75.8050, type:"rural" },
  { name:"Caicedonia Zona 29", lat:4.3400, lng:-75.7900, type:"rural" },
  { name:"Caicedonia Zona 30", lat:4.3680, lng:-75.8000, type:"rural" }
];

        this.initializeMap();
        this.initializeEventListeners();
        this.initializeMobileMenu();
        this.updateTimestamp();
        setInterval(()=>this.updateTimestamp(), 1000);
        setInterval(()=>this.updateUptime(), 1000);

        // Crear muchos pol√≠gonos est√°ticos
        setTimeout(()=>{ this.createStaticPolygons(80); }, 1000);
      }

      initializeMap(){
        this.map = L.map('map').setView([3.5394, -76.3036], 10);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
          attribution:'&copy; OpenStreetMap contributors'
        }).addTo(this.map);

        this.map.on('contextmenu', function(e) {
          e.originalEvent.preventDefault();
          return false;
        });

        window.addEventListener('resize', () => {
          setTimeout(() => this.map.invalidateSize(), 100);
        });
      }

      initializeEventListeners(){
        document.getElementById('droneSearch')
          .addEventListener('input', e=>this.filterZones(e.target.value));

        const app = document.getElementById('app');
        const btnExpand = document.getElementById('btnExpand');
        const mapPanel = document.getElementById('mapPanel');

        const toggleExpand = ()=>{
          app.classList.toggle('map-expanded');
          const expanded = app.classList.contains('map-expanded');
          btnExpand.textContent = expanded ? '‚§° Restaurar paneles' : '‚§¢ Expandir mapa';
          setTimeout(()=> this.map.invalidateSize(), 300);
        };

        btnExpand.addEventListener('click', toggleExpand);
        mapPanel.addEventListener('dblclick', toggleExpand);

        const btnFull = document.getElementById('btnFullscreen');
        btnFull.addEventListener('click', async ()=>{
          try{
            const root = document.documentElement;
            if (!document.fullscreenElement){
              if (root.requestFullscreen) await root.requestFullscreen();
            } else {
              if (document.exitFullscreen) await document.exitFullscreen();
            }
          }catch(e){ console.warn('Fullscreen no disponible', e); }
          setTimeout(()=> this.map.invalidateSize(), 300);
        });

        document.addEventListener('fullscreenchange', ()=> setTimeout(()=> this.map.invalidateSize(), 250));
      }

      initializeMobileMenu(){
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const controlPanel = document.getElementById('controlPanel');
        const dronesPanel = document.getElementById('dronesPanel');
        const toggleControlPanel = document.getElementById('toggleControlPanel');
        const toggleDronesPanel = document.getElementById('toggleDronesPanel');

        mobileMenuBtn.addEventListener('click', () => {
          const menu = document.createElement('div');
          menu.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(11, 18, 32, 0.95);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 1rem;
          `;
          
          const buttons = [
            { text: 'üìä Panel de Control', action: () => controlPanel.classList.add('active') },
            { text: '‚úàÔ∏è Lista de Zonas', action: () => dronesPanel.classList.add('active') },
            { text: 'üó∫Ô∏è Solo Mapa', action: () => this.toggleMapOnly() },
            { text: '‚ùå Cerrar', action: () => document.body.removeChild(menu) }
          ];

          buttons.forEach(btn => {
            const button = document.createElement('button');
            button.textContent = btn.text;
            button.style.cssText = `
              padding: 1rem 2rem;
              background: linear-gradient(135deg, #2563eb, #7c3aed);
              color: white;
              border: none;
              border-radius: 12px;
              font-size: 1.1rem;
              font-weight: 600;
              cursor: pointer;
              width: 80%;
              max-width: 300px;
            `;
            button.addEventListener('click', () => {
              btn.action();
              document.body.removeChild(menu);
            });
            menu.appendChild(button);
          });

          document.body.appendChild(menu);
        });

        toggleControlPanel.addEventListener('click', () => controlPanel.classList.remove('active'));
        toggleDronesPanel.addEventListener('click', () => dronesPanel.classList.remove('active'));

        document.addEventListener('click', (e) => {
          if (!controlPanel.contains(e.target) && e.target !== mobileMenuBtn) {
            controlPanel.classList.remove('active');
          }
          if (!dronesPanel.contains(e.target) && e.target !== mobileMenuBtn) {
            dronesPanel.classList.remove('active');
          }
        });
      }

      toggleMapOnly(){
        const controlPanel = document.getElementById('controlPanel');
        const dronesPanel = document.getElementById('dronesPanel');
        controlPanel.classList.remove('active');
        dronesPanel.classList.remove('active');
      }

      createStaticPolygons(count){
        const droneTypes=['commercial','delivery','surveillance'];
        const missions = [
          'Entrega de alimentos','Vigilancia urbana','Monitoreo de tr√°fico',
          'Entrega de paquetes','Inspecci√≥n de infraestructura','Fotograf√≠a a√©rea',
          'Control de cultivos','Vigilancia rural','Mapeo topogr√°fico',
          'B√∫squeda y rescate','Monitoreo ambiental','Entrega express',
          'Patrullaje de seguridad','Monitoreo de cultivos','Vigilancia de obras'
        ];

        for (let i=0;i<count;i++){
          const id = `ZONA-${Math.random().toString(36).slice(2,8).toUpperCase()}`;
          const type = droneTypes[Math.floor(Math.random()*droneTypes.length)];
          const persona = this.personasNaturales[Math.floor(Math.random()*this.personasNaturales.length)];
          const mission = missions[Math.floor(Math.random()*missions.length)];

          // Seleccionar ubicaci√≥n aleatoria
          const location = this.puntosValleCauca[Math.floor(Math.random()*this.puntosValleCauca.length)];
          const esZonaUrbana = location.type === "urbana";

          const zoneData = {
            id, type, persona, mission,
            position:{ lat:location.lat, lng:location.lng },
            status:'activo',
            esZonaUrbana,
            locationName: location.name,
            lastUpdate: Date.now()
          };

          zoneData.estimatedArea = this.createEstimatedArea(zoneData);
          this.createPolygon(zoneData);

          this.polygons.set(id, zoneData);
        }

        this.addAlert(`${count} zonas de operaci√≥n creadas`,'success');
        this.updateUI(true);
      }

      createEstimatedArea(zoneData) {
        const sides = Math.random() > 0.5 ? 6 : 7; // Hex√°gono (6) o Hept√°gono (7)
        const radius = 0.005 + Math.random() * 0.008; // Radio del pol√≠gono
        const centerLat = zoneData.position.lat;
        const centerLng = zoneData.position.lng;
        
        const points = [];
        for (let i = 0; i < sides; i++) {
          const angle = (i / sides) * 2 * Math.PI;
          // Agregar peque√±a variaci√≥n aleatoria para hacerlo m√°s irregular
          const variedRadius = radius * (0.7 + Math.random() * 0.6);
          
          const lat = centerLat + variedRadius * Math.cos(angle);
          const lng = centerLng + variedRadius * Math.sin(angle);
          points.push([lat, lng]);
        }
        
        // Cerrar el pol√≠gono conectando el √∫ltimo punto con el primero
        points.push(points[0]);
        
        return points;
      }

      createPolygon(zoneData){
        if (!zoneData.estimatedArea) return;
        
        const polygon = L.polygon(zoneData.estimatedArea, {
          className: `polygon-fill polygon-${zoneData.type}`,
          fillOpacity: 0.15,
          weight: 2,
          opacity: 0.8,
          smoothFactor: 1
        }).addTo(this.map);

        polygon.bindPopup(`
          <div style="min-width:240px;">
            <b>${zoneData.id}</b><br>
            <span style="color:${this.getDroneColor(zoneData.type)}; font-weight:600;">
              ${zoneData.type.toUpperCase()}
            </span><br>
            Operador: ${zoneData.persona}<br>
            Misi√≥n: ${zoneData.mission}<br>
            Ubicaci√≥n: ${zoneData.locationName}<br>
            Tipo: ${zoneData.esZonaUrbana ? 'Urbana' : 'Rural'}<br>
            V√©rtices: ${zoneData.estimatedArea.length - 1}<br>
            Estado: <span style="color:#10b981;">ACTIVO</span>
          </div>
        `);
      }

      getDroneColor(type){
        const c = {
          commercial:'#ef4444',
          delivery:'#2563eb',
          surveillance:'#7c3aed'
        };
        return c[type] || '#2563eb';
      }

      updateUI(force=false){
        const now = performance.now();
        if (!force && now - this.lastUiUpdate < this.uiIntervalMs) return;
        this.lastUiUpdate = now;

        const total = this.polygons.size;
        const all = Array.from(this.polygons.values());
        const urban = all.filter(d=>d.esZonaUrbana).length;
        const rural = total - urban;
        const cali = all.filter(d=> d.locationName.includes('Cali')).length;
        const palmira = all.filter(d=> d.locationName.includes('Palmira')).length;

        document.getElementById('totalDrones').textContent = total;
        document.getElementById('activeFlights').textContent = total;
        document.getElementById('noLocationDrones').textContent = rural;
        document.getElementById('activePolygons').textContent = urban;
        document.getElementById('urbanDrones').textContent = total;
        document.getElementById('ruralDrones').textContent = cali;
        document.getElementById('updatedPolygons').textContent = palmira;
        document.getElementById('caliDrones').textContent = new Date().getSeconds();

        this.updateZonesList(all);
      }

      updateUptime(){
        const diff = Date.now() - this.startTime.getTime();
        const h = Math.floor(diff/3600000);
        const m = Math.floor((diff%3600000)/60000);
        const s = Math.floor((diff%60000)/1000);
        document.getElementById('uptime').textContent =
          `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
      }

      updateZonesList(zonesArray){
        const list = document.getElementById('dronesList');
        const search = (document.getElementById('droneSearch').value || "").toLowerCase();
        const frag = document.createDocumentFragment();

        zonesArray.forEach(zone=>{
          const text = `${zone.id} ${zone.type} ${zone.persona} ${zone.mission} ${zone.locationName}`.toLowerCase();
          if (search && !text.includes(search)) return;

          const zona = zone.esZonaUrbana ? 'Urbana' : 'Rural';

          const div = document.createElement('div');
          div.className='drone-item';
          div.innerHTML=`
            <div class="drone-item-header">
              <span class="drone-id">${zone.id}</span>
              <span class="drone-type" style="background:${this.getDroneColor(zone.type)}">${zone.type}</span>
            </div>
            <div class="drone-info">
              <strong>${zone.persona}</strong><br>
              <span style="color:#10b981;">üìç Zona Activa</span><br>
              Tipo: ${zona}<br>
              Ubicaci√≥n: ${zone.locationName}<br>
              Misi√≥n: ${zone.mission}<br>
              Estado: <span style="color:#10b981;">ACTIVO</span><br>
              V√©rtices: ${zone.estimatedArea.length - 1}
            </div>
          `;
          frag.appendChild(div);
        });

        list.innerHTML = '';
        list.appendChild(frag);
      }

      filterZones(){ this.updateUI(true); }

      addAlert(message, type='info'){
        const container = document.getElementById('alertsContainer');
        const alert = document.createElement('div');
        alert.className = `alert-item ${type}`;
        alert.innerHTML = `<span>${message}</span><small>${new Date().toLocaleTimeString()}</small>`;
        container.insertBefore(alert, container.firstChild);
        if (container.children.length > 8) container.removeChild(container.lastChild);
      }

      updateTimestamp(){ document.getElementById('timestamp').textContent = new Date().toLocaleTimeString(); }
    }

    document.addEventListener('DOMContentLoaded',()=>{ window.utmSimulation = new UTMSimulation(); });
  </script>
</body>
</html>
